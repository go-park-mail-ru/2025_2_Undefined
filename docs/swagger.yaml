basePath: /api/v1
definitions:
  dto.AddChatMemberDTO:
    properties:
      role:
        description: Роль пользователя в чате - админ(писать и добавлять участников),
          участник(писать), зритель (только просмотр)
        type: string
      user_id:
        format: uuid
        type: string
    type: object
  dto.AddUsersToChatDTO:
    properties:
      members:
        items:
          $ref: '#/definitions/dto.AddChatMemberDTO'
        type: array
    type: object
  dto.AuthResponse:
    properties:
      csrf_token:
        type: string
    type: object
  dto.ChatCreateInformationDTO:
    properties:
      members:
        items:
          $ref: '#/definitions/dto.AddChatMemberDTO'
        type: array
      name:
        type: string
      type:
        description: Тип чата - канал, диалог или группа
        type: string
    type: object
  dto.ChatDetailedInformationDTO:
    properties:
      can_chat:
        type: boolean
      description:
        type: string
      id:
        format: uuid
        type: string
      is_admin:
        type: boolean
      is_member:
        type: boolean
      is_private:
        type: boolean
      members:
        items:
          $ref: '#/definitions/dto.UserInfoChatDTO'
        type: array
      messages:
        items:
          $ref: '#/definitions/dto.MessageDTO'
        type: array
      name:
        type: string
      type:
        type: string
    type: object
  dto.ChatUpdateDTO:
    properties:
      description:
        type: string
      name:
        type: string
    type: object
  dto.ChatViewInformationDTO:
    properties:
      id:
        format: uuid
        type: string
      last_message:
        type: object
      name:
        type: string
      type:
        type: string
    type: object
  dto.DeleteSession:
    properties:
      id:
        type: string
    type: object
  dto.ErrorDTO:
    properties:
      message:
        type: string
    type: object
  dto.GetAvatarsRequest:
    properties:
      ids:
        items:
          type: string
        type: array
    required:
    - ids
    type: object
  dto.GetAvatarsResponse:
    properties:
      avatars:
        additionalProperties:
          type: string
        description: map[id]url
        type: object
    type: object
  dto.GetContactsDTO:
    properties:
      contact:
        $ref: '#/definitions/dto.User'
      created_at:
        type: string
      update_at:
        type: string
      user_id:
        type: string
    type: object
  dto.GetUserByPhone:
    properties:
      phone_number:
        type: string
    type: object
  dto.GetUserByUsername:
    properties:
      username:
        type: string
    type: object
  dto.IdDTO:
    properties:
      id:
        format: uuid
        type: string
    type: object
  dto.LoginRequest:
    properties:
      password:
        type: string
      phone_number:
        type: string
    required:
    - password
    - phone_number
    type: object
  dto.MessageDTO:
    properties:
      chat_id:
        format: uuid
        type: string
      created_at:
        format: date-time
        type: string
      id:
        format: uuid
        type: string
      sender_id:
        format: uuid
        type: string
      sender_name:
        type: string
      text:
        type: string
      type:
        description: Тип сообщения - системное или пользовательское
        type: string
      updated_at:
        format: date-time
        type: string
    type: object
  dto.PostContactDTO:
    properties:
      contact_id:
        type: string
    type: object
  dto.RegisterRequest:
    properties:
      name:
        type: string
      password:
        minLength: 6
        type: string
      phone_number:
        type: string
    required:
    - name
    - password
    - phone_number
    type: object
  dto.Session:
    properties:
      created_at:
        type: string
      device:
        type: string
      id:
        type: string
      last_seen:
        type: string
    type: object
  dto.UpdateUserInfo:
    properties:
      bio:
        type: string
      name:
        type: string
      username:
        type: string
    type: object
  dto.User:
    properties:
      account_type:
        type: string
      bio:
        type: string
      created_at:
        type: string
      id:
        format: uuid
        type: string
      name:
        type: string
      phone_number:
        type: string
      updated_at:
        type: string
      username:
        type: string
    type: object
  dto.UserInfoChatDTO:
    properties:
      role:
        description: Роль пользователя в чате - админ(писать и добавлять участников),
          участник(писать), зритель (только просмотр)
        type: string
      user_id:
        format: uuid
        type: string
      user_name:
        type: string
    type: object
  dto.ValidationErrorDTO:
    properties:
      field:
        type: string
      message:
        type: string
    type: object
  dto.ValidationErrorsDTO:
    properties:
      errors:
        items:
          $ref: '#/definitions/dto.ValidationErrorDTO'
        type: array
      message:
        type: string
    type: object
host: localhost:8080
info:
  contact:
    name: Undefined Team
    url: https://github.com/go-park-mail-ru/2025_2_Undefined
  description: API сервер для чат-приложения в стиле Telegram. Позволяет регистрировать
    пользователей, управлять чатами и обмениваться сообщениями.
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
  termsOfService: http://swagger.io/terms/
  title: Undefined team API documentation of project Telegram
  version: "1.0"
paths:
  /chats:
    get:
      consumes:
      - application/json
      description: Возвращает список всех чатов текущего пользователя с информацией
        о последнем сообщении
      produces:
      - application/json
      responses:
        "200":
          description: Список чатов
          schema:
            items:
              $ref: '#/definitions/dto.ChatViewInformationDTO'
            type: array
        "400":
          description: Некорректный запрос
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
        "401":
          description: Неавторизованный доступ
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
      security:
      - ApiKeyAuth: []
      summary: Получить список чатов
      tags:
      - chats
    post:
      consumes:
      - application/json
      description: Создает новый чат с указанными участниками и настройками
      parameters:
      - description: CSRF Token
        in: header
        name: X-CSRF-Token
        required: true
        type: string
      - description: Данные для создания чата
        in: body
        name: chat
        required: true
        schema:
          $ref: '#/definitions/dto.ChatCreateInformationDTO'
      produces:
      - application/json
      responses:
        "201":
          description: ID созданного чата
          schema:
            $ref: '#/definitions/dto.IdDTO'
        "400":
          description: Некорректный запрос
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
        "401":
          description: Неавторизованный доступ
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
      security:
      - ApiKeyAuth: []
      summary: Создать новый чат
      tags:
      - chats
  /chats/{chatId}:
    delete:
      consumes:
      - application/json
      description: Удаляет существующий чат. Только администратор чата может удалить
        чат.
      parameters:
      - description: CSRF Token
        in: header
        name: X-CSRF-Token
        required: true
        type: string
      - description: ID чата
        format: uuid
        in: path
        name: chatId
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
        "400":
          description: Некорректный запрос
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
        "401":
          description: Неавторизованный доступ
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
        "403":
          description: Нет прав для удаления чата
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
        "404":
          description: Чат не найден
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
      security:
      - ApiKeyAuth: []
      summary: Удалить чат
      tags:
      - chats
    get:
      consumes:
      - application/json
      description: Возвращает детальную информацию о конкретном чате, включая сообщения
        и участников
      parameters:
      - description: ID чата
        format: uuid
        in: path
        name: chatId
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Детальная информация о чате
          schema:
            $ref: '#/definitions/dto.ChatDetailedInformationDTO'
        "400":
          description: Некорректный запрос
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
        "401":
          description: Неавторизованный доступ
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
        "404":
          description: Не существует такого чата
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
      security:
      - ApiKeyAuth: []
      summary: Получить информацию о чате
      tags:
      - chats
    patch:
      consumes:
      - application/json
      description: Позволяет администратору изменить название и описание чата
      parameters:
      - description: CSRF Token
        in: header
        name: X-CSRF-Token
        required: true
        type: string
      - description: ID чата
        format: uuid
        in: path
        name: chatId
        required: true
        type: string
      - description: Поля для обновления чата
        in: body
        name: chat
        required: true
        schema:
          $ref: '#/definitions/dto.ChatUpdateDTO'
      produces:
      - application/json
      responses:
        "200":
          description: OK
        "400":
          description: Некорректный запрос
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
        "401":
          description: Неавторизованный доступ
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
        "403":
          description: Нет прав для изменения чата
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
        "404":
          description: Чат не найден
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
      security:
      - ApiKeyAuth: []
      summary: Обновить чат
      tags:
      - chats
  /chats/{chatId}/avatar:
    post:
      consumes:
      - multipart/form-data
      description: Загружает новый аватар для чата (только админ)
      parameters:
      - description: CSRF Token
        in: header
        name: X-CSRF-Token
        required: true
        type: string
      - description: ID чата
        format: uuid
        in: path
        name: chatId
        required: true
        type: string
      - description: Файл аватара
        in: formData
        name: avatar
        required: true
        type: file
      produces:
      - application/json
      responses:
        "200":
          description: URL загруженного аватара
          schema:
            additionalProperties:
              type: string
            type: object
        "400":
          description: Неверный формат запроса
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
        "401":
          description: Неавторизованный доступ
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
        "403":
          description: Нет прав для изменения чата
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
        "404":
          description: Чат не найден
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
      security:
      - ApiKeyAuth: []
      summary: Загрузить аватарку чата
      tags:
      - chats
  /chats/{chatId}/members:
    patch:
      consumes:
      - application/json
      description: Добавляет указанных пользователей в существующий чат
      parameters:
      - description: CSRF Token
        in: header
        name: X-CSRF-Token
        required: true
        type: string
      - description: ID чата
        format: uuid
        in: path
        name: chatId
        required: true
        type: string
      - description: Список пользователей для добавления
        in: body
        name: users
        required: true
        schema:
          $ref: '#/definitions/dto.AddUsersToChatDTO'
      produces:
      - application/json
      responses:
        "200":
          description: OK
        "400":
          description: Некорректный запрос
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
        "401":
          description: Неавторизованный доступ
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
      security:
      - ApiKeyAuth: []
      summary: Добавить пользователей в чат
      tags:
      - chats
  /chats/avatars:
    post:
      consumes:
      - application/json
      description: Возвращает аватарки для списка чатов по их ID
      parameters:
      - description: Список ID чатов
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/dto.GetAvatarsRequest'
      produces:
      - application/json
      responses:
        "200":
          description: Аватарки чатов
          schema:
            $ref: '#/definitions/dto.GetAvatarsResponse'
        "400":
          description: Некорректный запрос
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
        "401":
          description: Неавторизованный доступ
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
      security:
      - ApiKeyAuth: []
      summary: Получить аватарки чатов
      tags:
      - chats
  /chats/dialog/{otherUserId}:
    get:
      consumes:
      - application/json
      description: Возвращает информацию о личном чате между авторизованным пользователем
        и указанным пользователем. Если чата нет — возвращается ошибку.
      parameters:
      - description: ID другого пользователя
        format: uuid
        in: path
        name: otherUserId
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Информация о личном чате
          schema:
            $ref: '#/definitions/dto.IdDTO'
        "400":
          description: Некорректный ID пользователя
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
        "401":
          description: Неавторизованный доступ
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
        "404":
          description: Пользователь не найден
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
      security:
      - ApiKeyAuth: []
      summary: Получить личный диалог с пользователем
      tags:
      - chats
  /contacts:
    get:
      consumes:
      - application/json
      description: Возвращает список всех контактов текущего пользователя с полной
        информацией о пользователях
      produces:
      - application/json
      responses:
        "200":
          description: Список контактов успешно получен
          schema:
            items:
              $ref: '#/definitions/dto.GetContactsDTO'
            type: array
        "401":
          description: Неавторизованный доступ
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
        "500":
          description: Внутренняя ошибка сервера
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
      security:
      - ApiKeyAuth: []
      summary: Получение списка контактов
      tags:
      - contacts
    post:
      consumes:
      - application/json
      description: Добавляет нового пользователя в список контактов текущего пользователя
      parameters:
      - description: CSRF Token
        in: header
        name: X-CSRF-Token
        required: true
        type: string
      - description: Данные контакта для добавления
        in: body
        name: contact
        required: true
        schema:
          $ref: '#/definitions/dto.PostContactDTO'
      produces:
      - application/json
      responses:
        "201":
          description: Контакт успешно добавлен
        "400":
          description: Неверные данные запроса
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
        "401":
          description: Неавторизованный доступ
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
        "404":
          description: Пользователь не найден
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
        "500":
          description: Внутренняя ошибка сервера
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
      security:
      - ApiKeyAuth: []
      summary: Добавление контакта
      tags:
      - contacts
  /login:
    post:
      consumes:
      - application/json
      description: Аутентифицирует пользователя по номеру телефона и паролю через
        gRPC микросервис, создает сессию
      parameters:
      - description: Креденшиалы для входа
        in: body
        name: credentials
        required: true
        schema:
          $ref: '#/definitions/dto.LoginRequest'
      produces:
      - application/json
      responses:
        "200":
          description: Вход выполнен успешно
          schema:
            $ref: '#/definitions/dto.AuthResponse'
        "400":
          description: Ошибки валидации
          schema:
            $ref: '#/definitions/dto.ValidationErrorsDTO'
        "401":
          description: Неверные креденшиалы
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
      summary: Аутентификация пользователя
      tags:
      - auth
  /logout:
    post:
      consumes:
      - application/json
      description: Аннулирует текущую сессию через gRPC микросервис и удаляет cookie
      parameters:
      - description: CSRF Token
        in: header
        name: X-CSRF-Token
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Logout successful
        "401":
          description: Неавторизованный доступ
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
      security:
      - ApiKeyAuth: []
      summary: Выход из системы
      tags:
      - auth
  /me:
    get:
      consumes:
      - application/json
      description: Возвращает полные данные о текущем авторизованном пользователе
      produces:
      - application/json
      responses:
        "200":
          description: Информация о пользователе
          schema:
            $ref: '#/definitions/dto.User'
        "401":
          description: Неавторизованный доступ
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
      security:
      - ApiKeyAuth: []
      summary: Получить информацию о текущем пользователе
      tags:
      - user
    patch:
      consumes:
      - application/json
      description: Обновляет имя, username или bio текущего пользователя
      parameters:
      - description: CSRF Token
        in: header
        name: X-CSRF-Token
        required: true
        type: string
      - description: Данные для обновления
        in: body
        name: user
        required: true
        schema:
          $ref: '#/definitions/dto.UpdateUserInfo'
      produces:
      - application/json
      responses:
        "200":
          description: Информация успешно обновлена
        "400":
          description: Неверный формат запроса
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
        "401":
          description: Неавторизованный доступ
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
      security:
      - ApiKeyAuth: []
      summary: Обновить информацию о пользователе
      tags:
      - user
  /message/ws:
    get:
      consumes:
      - application/json
      description: |-
        Устанавливает WebSocket соединение для отправки и получения сообщений в реальном времени.
        После установки соединения клиент может отправлять сообщения в формате CreateMessageDTO
        и получать уведомления о новых сообщениях в формате MessageDTO.

        **Протокол WebSocket:**

        **Отправка сообщения (клиент → сервер):**
        ```json
        {
        "text": "Текст сообщения",
        "created_at": "2025-01-15T10:30:00Z",
        "chat_id": "123e4567-e89b-12d3-a456-426614174000"
        }
        ```

        **Получение сообщения (сервер → клиент):**
        ```json
        {
        "sender_name": "Имя отправителя",
        "sender_avatar": "https://example.com/avatar.jpg",
        "text": "Текст сообщения",
        "created_at": "2025-01-15T10:30:00Z",
        "chat_id": "123e4567-e89b-12d3-a456-426614174000"
        }
        ```

        **Обработка ошибок:**
        ```json
        {
        "error": "Описание ошибки"
        }
        ```
      produces:
      - application/json
      responses:
        "101":
          description: WebSocket соединение установлено
        "401":
          description: Пользователь не авторизован
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
        "500":
          description: Ошибка сервера при установке WebSocket соединения
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
      security:
      - Cookie: []
      summary: Установить WebSocket соединение для сообщений
      tags:
      - messages
  /register:
    post:
      consumes:
      - application/json
      description: Регистрирует нового пользователя в системе через gRPC микросервис
        и создает сессию
      parameters:
      - description: Данные для регистрации
        in: body
        name: user
        required: true
        schema:
          $ref: '#/definitions/dto.RegisterRequest'
      produces:
      - application/json
      responses:
        "201":
          description: Пользователь успешно зарегистрирован
          schema:
            $ref: '#/definitions/dto.AuthResponse'
        "400":
          description: Ошибки валидации
          schema:
            $ref: '#/definitions/dto.ValidationErrorsDTO'
      summary: Регистрация пользователя
      tags:
      - auth
  /session:
    delete:
      consumes:
      - application/json
      description: удалить конкретную сессию пользователя
      parameters:
      - description: CSRF Token
        in: header
        name: X-CSRF-Token
        required: true
        type: string
      - description: Сессию которую надо удалить
        in: body
        name: session
        required: true
        schema:
          $ref: '#/definitions/dto.DeleteSession'
      produces:
      - application/json
      responses:
        "200":
          description: сессия удалена
        "401":
          description: Неавторизованный доступ
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
        "404":
          description: Не удалось удалить
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
      security:
      - ApiKeyAuth: []
      summary: удалить сессию пользователя
      tags:
      - auth
  /sessions:
    delete:
      consumes:
      - application/json
      description: удалить сессии пользователя, кроме текущей
      parameters:
      - description: CSRF Token
        in: header
        name: X-CSRF-Token
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: сессии удалены
        "401":
          description: Неавторизованный доступ
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
        "404":
          description: Не удалось удалить сессии
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
      security:
      - ApiKeyAuth: []
      summary: удалить сессии пользователя, кроме текущей
      tags:
      - auth
    get:
      consumes:
      - application/json
      description: Возвращает все активные сессии текущего авторизованного пользователя
      produces:
      - application/json
      responses:
        "200":
          description: Список сессий пользователя
          schema:
            items:
              $ref: '#/definitions/dto.Session'
            type: array
        "401":
          description: Неавторизованный доступ
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
        "500":
          description: Внутренняя ошибка сервера
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
      security:
      - ApiKeyAuth: []
      summary: Получить список сессий пользователя
      tags:
      - auth
  /user/avatar:
    post:
      consumes:
      - multipart/form-data
      description: Загружает новый аватар для текущего пользователя
      parameters:
      - description: CSRF Token
        in: header
        name: X-CSRF-Token
        required: true
        type: string
      - description: Файл аватара
        in: formData
        name: avatar
        required: true
        type: file
      produces:
      - application/json
      responses:
        "200":
          description: URL загруженного аватара
          schema:
            additionalProperties:
              type: string
            type: object
        "400":
          description: Неверный формат запроса
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
        "401":
          description: Неавторизованный доступ
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
      security:
      - ApiKeyAuth: []
      summary: Загрузить аватар пользователя
      tags:
      - user
  /user/by-phone:
    post:
      consumes:
      - application/json
      description: Возвращает полные данные о пользователе по указанному номеру телефона
      parameters:
      - description: CSRF Token
        in: header
        name: X-CSRF-Token
        required: true
        type: string
      - description: Номер телефона
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/dto.GetUserByPhone'
      produces:
      - application/json
      responses:
        "200":
          description: Информация о пользователе
          schema:
            $ref: '#/definitions/dto.User'
        "400":
          description: Неверный формат запроса
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
        "401":
          description: Неавторизованный доступ
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
        "404":
          description: Пользователь не найден
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
      security:
      - ApiKeyAuth: []
      summary: Получить информацию о пользователе по номеру телефона
      tags:
      - user
  /user/by-username:
    post:
      consumes:
      - application/json
      description: Возвращает полные данные о пользователе по указанному username
      parameters:
      - description: CSRF Token
        in: header
        name: X-CSRF-Token
        required: true
        type: string
      - description: Username пользователя
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/dto.GetUserByUsername'
      produces:
      - application/json
      responses:
        "200":
          description: Информация о пользователе
          schema:
            $ref: '#/definitions/dto.User'
        "400":
          description: Неверный формат запроса
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
        "401":
          description: Неавторизованный доступ
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
        "404":
          description: Пользователь не найден
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
      security:
      - ApiKeyAuth: []
      summary: Получить информацию о пользователе по username
      tags:
      - user
  /users/avatars:
    post:
      consumes:
      - application/json
      description: Возвращает аватарки для списка пользователей по их ID
      parameters:
      - description: Список ID пользователей
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/dto.GetAvatarsRequest'
      produces:
      - application/json
      responses:
        "200":
          description: Аватарки пользователей
          schema:
            $ref: '#/definitions/dto.GetAvatarsResponse'
        "400":
          description: Некорректный запрос
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
        "401":
          description: Неавторизованный доступ
          schema:
            $ref: '#/definitions/dto.ErrorDTO'
      security:
      - ApiKeyAuth: []
      summary: Получить аватарки пользователей
      tags:
      - user
swagger: "2.0"
